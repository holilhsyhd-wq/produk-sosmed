<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Admin Barmods</title>

<style>
body{margin:0;background:#020617;color:#e5e7eb;font-family:Arial}
.wrapper{max-width:1000px;margin:auto;padding:16px}
.card{background:#0f172a;padding:14px;border-radius:14px;margin-bottom:14px}
.item{background:#020617;padding:10px;border-radius:10px;margin-top:10px}
button{padding:6px 10px;border:none;border-radius:10px;font-size:12px;margin-right:4px}
.p{background:#facc15}.pr{background:#38bdf8}.s{background:#22c55e}.e{background:#ef4444}
</style>
</head>

<body>

<div class="wrapper">
<h2>Admin Dashboard</h2>

<div class="card">
<h3>Users</h3>
<div id="users"></div>
</div>

<div class="card">
<h3>Orders</h3>
<div id="orders"></div>
</div>
</div>

<script type="module">
if(localStorage.getItem("adminLogin")!=="true") location.href="login-admin.html";

import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
import { getFirestore,collection,getDocs,doc,updateDoc } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";

const firebaseConfig={
 apiKey:"AIzaSyDnmNDGMl-EB5b7PmIuhjg7-6D0yX58pJ8",
 authDomain:"barmods-allsosmed.firebaseapp.com",
 projectId:"barmods-allsosmed",
 storageBucket:"barmods-allsosmed.appspot.com",
 messagingSenderId:"864045617186",
 appId:"1:864045617186:web:de246e8f46321015327a7b"
};

const app=initializeApp(firebaseConfig);
const db=getFirestore(app);

/* USERS */
const usersSnap=await getDocs(collection(db,"users"));
usersSnap.forEach(u=>{
 const d=u.data();
 document.getElementById("users").innerHTML+=`
  <div class="item">
   ${d.username} | Rp ${d.balance.toLocaleString("id-ID")}
   <button onclick="editSaldo('${u.id}',${d.balance})">Edit</button>
  </div>`;
});

/* ORDERS */
const orderSnap=await getDocs(collection(db,"orders"));
orderSnap.forEach(o=>{
 const d=o.data();
 document.getElementById("orders").innerHTML+=`
  <div class="item">
   <b>${d.product}</b><br>
   Input: ${d.input}<br>
   Status: ${d.status}<br>
   <button class="p" onclick="set('${o.id}','pending')">P</button>
   <button class="pr" onclick="set('${o.id}','process')">PR</button>
   <button class="s" onclick="set('${o.id}','success')">S</button>
   <button class="e" onclick="set('${o.id}','error')">E</button>
  </div>`;
});

window.set=async(id,s)=>{
 await updateDoc(doc(db,"orders",id),{status:s});
 location.reload();
}

window.editSaldo=async(id,now)=>{
 const v=prompt("Saldo baru:",now);
 if(v!==null){
  await updateDoc(doc(db,"users",id),{balance:Number(v)});
  location.reload();
 }
}
</script>

</body>
</html>
