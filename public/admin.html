<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Admin Produk - Barmods</title>

<style>
body{margin:0;background:#020617;color:#e5e7eb;font-family:Arial}
.wrapper{max-width:900px;margin:auto;padding:16px}
.card{background:#0f172a;padding:14px;border-radius:14px;margin-bottom:14px}
.item{background:#020617;padding:10px;border-radius:10px;margin-top:10px}
input{width:100%;padding:8px;border-radius:8px;border:none;margin-top:6px}
button{padding:6px 10px;border:none;border-radius:8px;margin-top:6px}
.save{background:#22c55e}
.del{background:#ef4444}
</style>
</head>

<body>

<div class="wrapper">
<h2>Admin â€“ Produk</h2>

<div class="card">
  <h3>Daftar Produk</h3>
  <div id="list"></div>
</div>

<div class="card">
  <h3>Tambah Produk</h3>
  <input id="name" placeholder="Nama Produk">
  <input id="price" type="number" placeholder="Harga">
  <input id="type" placeholder="Type (tt_follow, ig_view, dll)">
  <input id="cat" placeholder="Category (followers, views, likes, wa)">
  <button class="save" onclick="add()">Tambah Produk</button>
</div>
</div>

<script type="module">
if(localStorage.getItem("adminLogin")!=="true"){
  location.href="login-admin.html";
}

import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
import {
 getFirestore,collection,getDocs,addDoc,updateDoc,deleteDoc,doc
} from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";

const firebaseConfig={
 apiKey:"AIzaSyDnmNDGMl-EB5b7PmIuhjg7-6D0yX58pJ8",
 authDomain:"barmods-allsosmed.firebaseapp.com",
 projectId:"barmods-allsosmed",
 storageBucket:"barmods-allsosmed.appspot.com",
 messagingSenderId:"864045617186",
 appId:"1:864045617186:web:de246e8f46321015327a7b"
};

const app=initializeApp(firebaseConfig);
const db=getFirestore(app);

const box=document.getElementById("list");

/* LOAD */
const snap=await getDocs(collection(db,"products"));
snap.forEach(p=>{
 const d=p.data();
 box.innerHTML+=`
 <div class="item">
  <b>${d.name}</b><br>
  Nama:
  <input value="${d.name}" onchange="updName('${p.id}',this.value)">
  Harga:
  <input value="${d.price}" onchange="updPrice('${p.id}',this.value)">
  <button class="del" onclick="delProd('${p.id}')">Hapus</button>
 </div>`;
});

/* UPDATE */
window.updName=async(id,val)=>{
 await updateDoc(doc(db,"products",id),{name:val});
};
window.updPrice=async(id,val)=>{
 await updateDoc(doc(db,"products",id),{price:Number(val)});
};

/* ADD */
window.add=async()=>{
 if(!name.value||!price.value||!type.value||!cat.value)
  return alert("Lengkapi data");

 await addDoc(collection(db,"products"),{
  name:name.value,
  price:Number(price.value),
  type:type.value,
  category:cat.value,
  active:true
 });
 location.reload();
};

/* DELETE */
window.delProd=async(id)=>{
 if(confirm("Hapus produk?")){
  await deleteDoc(doc(db,"products",id));
  location.reload();
 }
};
</script>

</body>
</html>
