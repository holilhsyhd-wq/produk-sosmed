<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Wallet - Barmods Store</title>

<style>
body{
  margin:0;
  font-family:Arial,Helvetica,sans-serif;
  background:#020617;
  color:#e5e7eb;
}
.wrapper{
  max-width:800px;
  margin:auto;
  padding:16px;
  padding-bottom:90px;
}
.header{
  background:linear-gradient(135deg,#16a34a,#22c55e);
  padding:18px;
  border-radius:16px;
  margin-bottom:16px;
}
.card{
  background:#0f172a;
  padding:14px;
  border-radius:14px;
  margin-bottom:12px;
}
button{
  width:100%;
  padding:12px;
  border:none;
  border-radius:20px;
  background:#22c55e;
  font-weight:bold;
}
input{
  width:100%;
  padding:12px;
  border-radius:10px;
  border:none;
  margin-bottom:10px;
}
.badge{
  padding:4px 10px;
  border-radius:12px;
  font-size:12px;
  font-weight:bold;
}
.pending{background:#facc15;color:#000}
.success{background:#22c55e;color:#000}

/* NAV */
.nav{
  position:fixed;
  bottom:0;left:0;right:0;
  background:#020617;
  border-top:1px solid #0f172a;
  display:grid;
  grid-template-columns:repeat(4,1fr);
}
.nav a{
  padding:12px 0;
  text-align:center;
  color:#94a3b8;
  text-decoration:none;
  font-size:12px;
}
.nav a.active{
  color:#38bdf8;
  font-weight:bold;
}
</style>
</head>

<body>

<div class="wrapper">
  <div class="header">
    <h2>Wallet</h2>
    <div>Saldo & Deposit</div>
  </div>

  <div class="card">
    Saldo kamu:<br>
    <b id="saldo">Rp 0</b>
  </div>

  <div class="card">
    <h3>Top Up Saldo</h3>
    <div>Transfer ke:</div>
    <b>DANA: 6285973928253</b><br>
    <small>a.n. Muhamad Barhudin</small><br><br>

    <input id="amount" type="number" placeholder="Nominal (min 5000)">
    <input id="sender" placeholder="Nama Pengirim">
    <button id="depositBtn">Saya Sudah Transfer</button>
  </div>

  <div class="card">
    <h3>Riwayat Deposit</h3>
    <div id="depositList"></div>
  </div>
</div>

<div class="nav">
  <a href="index.html">Store</a>
  <a class="active" href="wallet.html">Wallet</a>
  <a href="orders.html">Orders</a>
  <a href="profile.html">Profile</a>
</div>

<!-- FIREBASE V8 -->
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-auth.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-firestore.js"></script>

<script>
firebase.initializeApp({
  apiKey: "AIzaSyDnmNDGMl-EB5b7PmIuhjg7-6D0yX58pJ8",
  authDomain: "barmods-allsosmed.firebaseapp.com",
  projectId: "barmods-allsosmed"
});

const auth=firebase.auth();
const db=firebase.firestore();

const saldoEl=document.getElementById("saldo");
const depositList=document.getElementById("depositList");

let userData={};

auth.onAuthStateChanged(async user=>{
  if(!user){location.href="login.html";return;}
  const snap=await db.collection("users").doc(user.uid).get();
  userData={id:user.uid,...snap.data()};
  saldoEl.innerText="Rp "+userData.balance.toLocaleString("id-ID");
  loadDeposits();
});

/* SUBMIT DEPOSIT */
depositBtn.onclick=async()=>{
  const amt=parseInt(amount.value);
  if(!amt || amt<5000)return alert("Minimal deposit 5.000");
  if(!sender.value)return alert("Nama pengirim wajib diisi");

  await db.collection("deposits").add({
    userId:userData.id,
    amount:amt,
    sender:sender.value,
    status:"pending",
    createdAt:new Date()
  });

  alert("Deposit dikirim, menunggu admin");
  amount.value="";
  sender.value="";
};

/* LOAD DEPOSIT */
function loadDeposits(){
  db.collection("deposits")
    .where("userId","==",userData.id)
    .orderBy("createdAt","desc")
    .onSnapshot(snap=>{
      depositList.innerHTML="";
      snap.forEach(d=>{
        const x=d.data();
        depositList.innerHTML+=`
          <div class="card">
            Rp ${x.amount.toLocaleString("id-ID")} <br>
            ${x.sender}<br>
            <span class="badge ${x.status}">
              ${x.status.toUpperCase()}
            </span>
          </div>
        `;
      });
    });
}
</script>

</body>
</html>
